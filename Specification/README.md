FORMAT: 1A

# BrAPI Overview

The Breeding API specifies a standard interface for plant phenotype/genotype databases to serve 
their data to crop breeding applications. It is a <i>shared</i>, <i>open</i> API, to be
used by all data providers and data consumers who wish to participate. Initiated in May 2014, it is
currently in an actively developing state, so now is the time for potential participants to help
shape the specifications to ensure their needs are addressed. The listserve for discussions and 
announcements is at http://mail2.sgn.cornell.edu/cgi-bin/mailman/listinfo/plant-breeding-api .
Additional documentation is in the <a href="https://github.com/plantbreeding/documentation">Github wiki</a>.

### URL structure

API requests are structured as "\<server\>/brapi/v1/", 
where "v1" is the version number of the API, followed by the command.  
Example: /brapi/v1/markerprofiles/2939 

To distinguish between multiple databases or crops available from the same server, include the database or crop name as part of the "\<server\>" identifier. An arbitrary number of levels can be inserted between the domain name and the crops or brapi level, if needed.

Example: superBreedingServer.org/maize/brapi/v1/markerprofiles/2939

### Structure of the response object:
The return objects are encoded in JSON. 
The response always consists of a "metadata" key that minimally 
contains the pagination information in a "pagination" key and the status information as well as a "datafiles" key that lists URLs to data files generated by the call.

If the response is a single record that doesn't require pagination, then the value for the "pagination" key is returned with all the keys set to zero.  When the results are paginated, 
the keys "pageSize", "currentPage", "totalCount", "totalPages" contain the appropriate values. Note that pages are zero indexed, so the first page will be page 0 (zero). (For the user interface, this may be adjusted by adding 1).

The status object contains a list of objects with the keys "code" and "message". If no status is reported, the empty list should be returned.

The datafiles key contains a list of strings. The empty list should be returned if no datafiles are present.

The payload data is contained in a key called "result", containing an object with the response. If there is a paginated response, a "data" key will be present, with a list value, which will be paginated over (showing pageSize elements of the currentPage).

Additional documentation is in the [GitHub wiki](https://github.com/plantbreeding/documentation/wiki). 
See especially the [Best Practices and Conventions]
(https://github.com/plantbreeding/documentation/wiki/Best-Practices-and-Conventions).

### HTTP error codes

HTTP error codes are used as required, e.g., 200 for ok, 404 for page not found, 401 for not authorized, 501 for not implemented, 201 for created in a PUT, 202 for request received but not yet processed, etc.

All capturable errors should be responded to with the appropriate HTTP error code and a well forumlated JSON structure that includes a message describing the error.  The error code is intedended as a debugging tool for the service provider.  An example:

+ Response 400 (application/json) 

        { 
            "metadata" : {
                 "pagination": {
                    "pageSize":0, 
                    "currentPage":0, 
                    "totalCount":0, 
                    "totalPages":0 
                },
                "status" : [ {
                    "message": "Unable to parse POST request",
                    "code" : "" 
                } ],
                "datafiles": []
            },
            "result": {}
        }

### Asynchronous Processing

Some calls initiate asynchronous processing, which take an indeterminate amount of time to complete. For example, the allelematrix-search may initiate a background process that extracts the requested data from a data warehouse. In this case, 

* The status array of the call's response will a key called **asynchid**, the value of which is an id that will be used in additional calls; 
* The resource from which the response was receive will have a child resource called **status** to which the **asynchid** is a uri parameter; a GET on this resource will indicate the current status of the job; 
* The status array of the response from the status resource will include a key called **asynchstatus** that will indicate the following possible states with the specified meanings: 
        * STARTED: The job has been initiated and has not yet been touched by the background process; 
        * INPROCESS: The background process is working on the job;
        * FINISHED: The job has completed succesfully, in which case:
                * The datafiles list of the response with this **asynchstatus** is required to have at least one entry that is a file path or uri to the directory or file of interest; and/or
                * The data array in the result contains the matrix data;
        * FAILED: The job has failed;
* In the case where the **asynchstatus** is FAILED, the status array of the response from the status resource may, but is not requried, to have a key called **asynchfailure**, the value of which indicates the cause of the job failure (some systems may prefer to use email notification either instead of or in addition to this mechanism). 
        
 

For example, a call to allelematrix-search might give the following response: 

<code>
{
    "metadata": {   
        "pagination": {
            "pageSize": 0,
            "currentPage": 0,
            "totalCount": 0,
            "totalPages": 0
        },
        "status": ["asynchid" : "extract_2016-12-15-20-37-015"],
        "datafiles": [/shared_files/app_test/file_bundle/crops/rice/extract/output/721]
    },
    "result" : { 
        "data": []
    }
}
</code>

Given this response, a GET on the resource **/allelematrix-search/status/extract_2016-12-15-20-37-015** will give a response as follows:

<code>
{
    "metadata": {   
        "pagination": {
            "pageSize": 0,
            "currentPage": 0,
            "totalCount": 0,
            "totalPages": 0
        },
        "status": ["asycnstatus" : "INPROCESS"],
        "datafiles": [/shared_files/app_test/file_bundle/crops/rice/extract/output/721]
    },
    "result" : { 
        "data": []
    }
}
</code>

The above example shows the folder path to the output in the datafiles array of both the initial request and the subsequent call on the status resource. However, the only case in which it is required to populate either the datafiles array and/or the data array is when the value of **asynchstatus** is FINISHED.  

### API call categories:  
Scope: "CORE", "PHENOTYPING", "GENOTYPING", "OTHER".  
Status: "STABLE", "ACCEPTED", "IN DISCUSSION", "SUGGESTED".
